<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="store.teabliss.tea.mapper.TeaMapper">


<!--    <insert id="createTea" parameterType="Tea" useGeneratedKeys="true" keyColumn="TeaId">-->
<!--        INSERT INTO TEA ()-->
<!--        VALUES(#{email}, #{password}, #{nickname})-->
<!--    </insert>-->

    <insert id="save" parameterType="Tea" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO TEA (price, category, review, sale, rating, rate, season, name, name_eng, caffeine, description, img, inventory, sale_status)
        VALUES (#{price}, #{category}, #{review}, #{sale}, #{rating}, #{rate}, #{season}, #{name}, #{nameEng}, #{caffeine}, #{description}, #{img}, #{inventory}, #{saleStatus})
    </insert>

    <insert id="saveIngredient" parameterType="store.teabliss.tea.entity.TeaIngredient">
        INSERT INTO TEAINGREDIENT (tea_id, ingredient_id)
        VALUES (#{teaId}, #{ingredientId})
    </insert>

    <insert id="saveFlavor" parameterType="store.teabliss.tea.entity.TeaFlavor">
        INSERT INTO TEAFLAVOR (tea_id, flavor_id)
        VALUES (#{teaId}, #{flavor})
    </insert>

    <select id="recommend">
        SELECT *
        FROM TEA
        ORDER BY rate DESC, createDt
    </select>

    <select id="sale">
        SELECT *
        FROM TEA
        ORDER BY sale DESC, createDt
    </select>

    <select id="topcost">
        SELECT *
        FROM TEA
        ORDER BY price DESC, createDt
    </select>

    <select id="lowcost">
        SELECT *
        FROM TEA
        ORDER BY price, createDt
    </select>

    <select id="all">
        SELECT *
        FROM TEA
    </select>

    <select id="count">
        SELECT count(*)
        FROM TEA
    </select>

    <select id="category">
        SELECT *
        FROM TEA
        WHERE category = #{category}
    </select>

    <select id="countByCategory">
        SELECT count(*)
        FROM TEA
        WHERE category = #{category}
    </select>

    <select id="search">
        SELECT img, name, name_eng, price
        FROM TEA
        WHERE name=#{product}
    </select>

    <select id="findbyid">
        SELECT *
        FROM TEA
        WHERE id=#{id}
    </select>

    <select id="findbyingredient">
        SELECT ingredient_id
        FROM TeaIngredient
        WHERE tea_id =#{id}

    </select>

    <select id="findbyflavor">
        SELECT flavor_id
        FROM TeaFlavor
        WHERE tea_id =#{id}

    </select>

    <select id="seasonsort">
        SELECT *
        FROM TEA
        WHERE season=#{season}
    </select>

    <select id="caffeinesort">
        SELECT *
        FROM TEA
        WHERE caffeine=#{caffeine}
    </select>

    <delete id="deletetea">
        DELETE FROM TEA
        WHERE 1=1
        AND id= #{id}
    </delete>

    <update id="patchtea">
        UPDATE TEA
        SET quality= IFNULL(#{quantity}, quantity),
        type = IFNULL(#{type}, type)
        WHERE id=#{id}
    </update>

    <update id="updateIngredient" parameterType="Ingredient">
        UPDATE TEA
        SET
        price = IFNULL(#{price}, price),
        category = IFNULL(#{category}, category),
        name = IFNULL(#{name}, name),
        name_eng = IFNULL(#{nameEng}, name_eng),
        caffeine = IFNULL(#{caffeine}, caffeine),
        description = IFNULL(#{description}, description),
        img = IFNULL(#{img}, img),
        inventory = IFNULL(#{inventory}, inventory)

        WHERE 1=1
        AND id= #{id}
    </update>






</mapper>