<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="store.teabliss.member.mapper.MemberMapper">

    <insert id="createMember" parameterType="Member" useGeneratedKeys="true" keyProperty="memId" keyColumn="mem_id">
        INSERT INTO MEMBER
        (
            email
            , password
            , nickname
            , role
            , provider
            , provider_id
        )
        VALUES
        (
            #{email}
            , #{password}
            , #{nickname}
            , #{role}
            , #{provider}
            , #{providerId}
        )
    </insert>

    <select id="findByEmail" parameterType="String">
        SELECT
            *
        FROM MEMBER
        WHERE 1=1
        AND email = #{value}
    </select>

    <select id="existsByEmail" parameterType="String">
        SELECT EXISTS
        (
        SELECT 1
        FROM MEMBER
        WHERE 1=1
        AND email = #{value}
        )
    </select>

    <select id="existsByNickname" parameterType="String">
        SELECT EXISTS
        (
        SELECT 1
        FROM MEMBER
        WHERE 1=1
        AND nickname = #{value}
        )
    </select>

    <select id="findByRefreshToken" parameterType="String">
        SELECT
        *
        FROM MEMBER
        WHERE 1=1
        AND refreshToken = #{value}
    </select>

    <update id="updateMember" parameterType="Member">
        UPDATE MEMBER
        SET
            <if test="password != null and password != ''">
            password = #{password},
            </if>
            nickname = IFNULL(#{nickname}, nickname),
            profile = IFNULL(#{profile}, profile)
        WHERE 1=1
        AND mem_id = #{memId}

    </update>
    
    <update id="updateRefreshToken" parameterType="Member">
        UPDATE MEMBER
        SET
           refresh_token = #{refreshToken}
        WHERE 1=1
        AND mem_id = #{memId}
    </update>
    
    <delete id="deleteMember" parameterType="String">
        DELETE FROM MEMBER
        WHERE 1=1
        AND email = #{value}
    </delete>

</mapper>